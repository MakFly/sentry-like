<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataPulse Analytics - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(240 10% 3.9%)',
                        foreground: 'hsl(0 0% 98%)',
                        card: 'hsl(240 10% 7%)',
                        border: 'hsl(240 3.7% 15.9%)',
                        primary: 'hsl(217 91% 60%)',
                        muted: 'hsl(240 3.7% 15.9%)',
                        'muted-foreground': 'hsl(240 5% 64.9%)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: hsl(240 10% 3.9%);
            background-image:
                radial-gradient(ellipse 80% 50% at 50% -20%, hsl(217 91% 60% / 0.12), transparent);
        }
        .gradient-text {
            background: linear-gradient(135deg, hsl(217 91% 70%), hsl(262 83% 68%));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .btn-glow:hover {
            box-shadow: 0 0 20px hsl(217 91% 60% / 0.3);
            transform: translateY(-1px);
        }
        .card-glow {
            transition: all 0.3s ease;
        }
        .card-glow:hover {
            border-color: hsl(217 91% 60% / 0.4);
            box-shadow: 0 4px 20px hsl(217 91% 60% / 0.1);
        }
        .kpi-card {
            position: relative;
            overflow: hidden;
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--color), transparent);
            opacity: 0.5;
        }
        .loading-spinner {
            border: 2px solid hsl(240 3.7% 15.9%);
            border-top-color: hsl(217 91% 60%);
            animation: spin 0.6s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .skeleton {
            background: linear-gradient(90deg, hsl(240 3.7% 15.9%) 25%, hsl(240 3.7% 20%) 50%, hsl(240 3.7% 15.9%) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .data-point {
            transition: all 0.2s ease;
        }
        .data-point:hover {
            background-color: hsl(217 91% 60% / 0.1);
        }
    </style>
</head>
<body class="dark min-h-screen text-foreground">
    <!-- Header -->
    <header class="border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center shadow-lg shadow-blue-600/20">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold gradient-text">DataPulse Analytics</h1>
                        <p class="text-xs text-muted-foreground">Real-time business intelligence</p>
                    </div>
                </div>
                <!-- Navigation -->
                <nav class="hidden md:flex items-center gap-4">
                    <a href="{{ path('app_home') }}" class="px-3 py-1.5 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">TechStore</a>
                    <a href="{{ path('app_analytics') }}" class="px-3 py-1.5 text-sm font-medium text-primary border-b-2 border-primary">Analytics</a>
                    <a href="{{ path('app_banking') }}" class="px-3 py-1.5 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">Banking</a>
                    <a href="{{ path('app_tests') }}" class="px-3 py-1.5 text-sm font-medium text-purple-400 hover:text-purple-300 transition-colors flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                        Tests
                    </a>
                </nav>
                <div class="flex items-center gap-3">
                    <button id="refresh-btn" onclick="refreshDashboard()" class="btn-glow px-4 py-2 bg-muted hover:bg-muted/80 text-foreground border border-border rounded-lg transition-all text-sm font-medium flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Refresh
                    </button>
                    <button id="export-csv-btn" onclick="exportCSV()" class="btn-glow px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary border border-primary/30 rounded-lg transition-all text-sm font-medium flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Export CSV
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Filters -->
        <div class="mb-6 flex flex-wrap items-center gap-4 p-4 rounded-xl bg-card border border-border">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                </svg>
                <span class="text-sm font-medium text-muted-foreground">Filters:</span>
            </div>

            <select id="date-range" onchange="handleDateRangeChange(this.value)" class="px-3 py-2 bg-muted border border-border rounded-lg text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50">
                <option value="today">Today</option>
                <option value="7days" selected>Last 7 days</option>
                <option value="30days">Last 30 days</option>
                <option value="90days">Last 90 days</option>
                <option value="year">This year</option>
            </select>

            <select id="region" class="px-3 py-2 bg-muted border border-border rounded-lg text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50">
                <option value="all">All Regions</option>
                <option value="us">North America</option>
                <option value="eu">Europe</option>
                <option value="asia">Asia Pacific</option>
                <option value="latam">Latin America</option>
            </select>

            <select id="product-category" class="px-3 py-2 bg-muted border border-border rounded-lg text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50">
                <option value="all">All Categories</option>
                <option value="enterprise">Enterprise</option>
                <option value="pro">Professional</option>
                <option value="starter">Starter</option>
            </select>

            <div class="ml-auto flex items-center gap-2 text-xs text-muted-foreground">
                <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                <span>Live data</span>
                <span class="text-muted-foreground/50">‚Ä¢</span>
                <span id="last-updated">Updated just now</span>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Revenue Card -->
            <div class="kpi-card card-glow p-6 rounded-xl bg-card border border-border" style="--color: hsl(142 76% 56%)">
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <p class="text-sm text-muted-foreground mb-1">Monthly Revenue</p>
                        <h3 class="text-3xl font-bold text-white">$247.8K</h3>
                    </div>
                    <div class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                        <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="flex items-center text-emerald-400 text-sm font-medium">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                        </svg>
                        12.5%
                    </span>
                    <span class="text-xs text-muted-foreground">vs last month</span>
                </div>
            </div>

            <!-- Users Card -->
            <div class="kpi-card card-glow p-6 rounded-xl bg-card border border-border" style="--color: hsl(217 91% 60%)">
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <p class="text-sm text-muted-foreground mb-1">Active Users</p>
                        <h3 class="text-3xl font-bold text-white">18,429</h3>
                    </div>
                    <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                        <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="flex items-center text-blue-400 text-sm font-medium">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                        </svg>
                        8.3%
                    </span>
                    <span class="text-xs text-muted-foreground">vs last month</span>
                </div>
            </div>

            <!-- Conversion Rate Card -->
            <div class="kpi-card card-glow p-6 rounded-xl bg-card border border-border" style="--color: hsl(262 83% 58%)">
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <p class="text-sm text-muted-foreground mb-1">Conversion Rate</p>
                        <h3 class="text-3xl font-bold text-white">24.8%</h3>
                    </div>
                    <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                        <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="flex items-center text-purple-400 text-sm font-medium">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                        </svg>
                        3.2%
                    </span>
                    <span class="text-xs text-muted-foreground">vs last month</span>
                </div>
            </div>

            <!-- Churn Rate Card -->
            <div class="kpi-card card-glow p-6 rounded-xl bg-card border border-border" style="--color: hsl(38 92% 50%)">
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <p class="text-sm text-muted-foreground mb-1">Churn Rate</p>
                        <h3 class="text-3xl font-bold text-white">2.1%</h3>
                    </div>
                    <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center">
                        <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="flex items-center text-emerald-400 text-sm font-medium">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                        </svg>
                        0.4%
                    </span>
                    <span class="text-xs text-muted-foreground">vs last month</span>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Revenue Chart -->
            <div class="card-glow p-6 rounded-xl bg-card border border-border">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-lg font-semibold text-white">Revenue Overview</h3>
                        <p class="text-sm text-muted-foreground">Monthly recurring revenue trend</p>
                    </div>
                    <select class="px-3 py-1.5 bg-muted border border-border rounded-lg text-xs text-foreground">
                        <option>Last 6 months</option>
                        <option>Last 12 months</option>
                    </select>
                </div>
                <div class="h-64">
                    <canvas id="revenue-chart"></canvas>
                </div>
            </div>

            <!-- Users Chart -->
            <div class="card-glow p-6 rounded-xl bg-card border border-border">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-lg font-semibold text-white">User Growth</h3>
                        <p class="text-sm text-muted-foreground">New vs. returning users</p>
                    </div>
                    <select class="px-3 py-1.5 bg-muted border border-border rounded-lg text-xs text-foreground">
                        <option>Last 7 days</option>
                        <option>Last 30 days</option>
                    </select>
                </div>
                <div class="h-64">
                    <canvas id="users-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="card-glow rounded-xl bg-card border border-border">
            <div class="p-6 border-b border-border">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-white">Top Products by Revenue</h3>
                        <p class="text-sm text-muted-foreground">Performance breakdown by product category</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <input type="text" placeholder="Search products..." class="px-3 py-2 bg-muted border border-border rounded-lg text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 w-64">
                        <button class="px-3 py-2 bg-muted hover:bg-muted/80 border border-border rounded-lg text-sm transition-all">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-muted/30">
                        <tr class="text-left text-xs text-muted-foreground">
                            <th class="px-6 py-4 font-medium">Product</th>
                            <th class="px-6 py-4 font-medium">Category</th>
                            <th class="px-6 py-4 font-medium">Revenue</th>
                            <th class="px-6 py-4 font-medium">Units Sold</th>
                            <th class="px-6 py-4 font-medium">Conversion</th>
                            <th class="px-6 py-4 font-medium">Trend</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-border">
                        <tr class="data-point">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center">
                                        <span class="text-white font-semibold text-sm">EP</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-white">Enterprise Plan</p>
                                        <p class="text-xs text-muted-foreground">Premium tier</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2.5 py-1 bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 text-xs font-medium rounded-full">Enterprise</span>
                            </td>
                            <td class="px-6 py-4">
                                <p class="text-sm font-semibold text-white">$124,580</p>
                                <p class="text-xs text-muted-foreground">50.3% of total</p>
                            </td>
                            <td class="px-6 py-4 text-sm text-foreground">1,247</td>
                            <td class="px-6 py-4 text-sm text-foreground">32.4%</td>
                            <td class="px-6 py-4">
                                <span class="flex items-center text-emerald-400 text-sm font-medium">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                                    </svg>
                                    15.2%
                                </span>
                            </td>
                        </tr>
                        <tr class="data-point">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                                        <span class="text-white font-semibold text-sm">PP</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-white">Professional Plan</p>
                                        <p class="text-xs text-muted-foreground">Mid tier</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2.5 py-1 bg-blue-500/20 text-blue-400 border border-blue-500/30 text-xs font-medium rounded-full">Professional</span>
                            </td>
                            <td class="px-6 py-4">
                                <p class="text-sm font-semibold text-white">$78,240</p>
                                <p class="text-xs text-muted-foreground">31.6% of total</p>
                            </td>
                            <td class="px-6 py-4 text-sm text-foreground">2,608</td>
                            <td class="px-6 py-4 text-sm text-foreground">26.1%</td>
                            <td class="px-6 py-4">
                                <span class="flex items-center text-emerald-400 text-sm font-medium">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                                    </svg>
                                    8.7%
                                </span>
                            </td>
                        </tr>
                        <tr class="data-point">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                                        <span class="text-white font-semibold text-sm">SP</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-white">Starter Plan</p>
                                        <p class="text-xs text-muted-foreground">Entry tier</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2.5 py-1 bg-purple-500/20 text-purple-400 border border-purple-500/30 text-xs font-medium rounded-full">Starter</span>
                            </td>
                            <td class="px-6 py-4">
                                <p class="text-sm font-semibold text-white">$44,980</p>
                                <p class="text-xs text-muted-foreground">18.1% of total</p>
                            </td>
                            <td class="px-6 py-4 text-sm text-foreground">4,498</td>
                            <td class="px-6 py-4 text-sm text-foreground">18.9%</td>
                            <td class="px-6 py-4">
                                <span class="flex items-center text-emerald-400 text-sm font-medium">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                                    </svg>
                                    5.3%
                                </span>
                            </td>
                        </tr>
                        <tr class="data-point">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center">
                                        <span class="text-white font-semibold text-sm">AO</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-white">Add-on Services</p>
                                        <p class="text-xs text-muted-foreground">Extra features</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2.5 py-1 bg-amber-500/20 text-amber-400 border border-amber-500/30 text-xs font-medium rounded-full">Add-ons</span>
                            </td>
                            <td class="px-6 py-4">
                                <p class="text-sm font-semibold text-white">$12,340</p>
                                <p class="text-xs text-muted-foreground">5.0% of total</p>
                            </td>
                            <td class="px-6 py-4 text-sm text-foreground">823</td>
                            <td class="px-6 py-4 text-sm text-foreground">15.2%</td>
                            <td class="px-6 py-4">
                                <span class="flex items-center text-amber-400 text-sm font-medium">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14"/>
                                    </svg>
                                    0.8%
                                </span>
                            </td>
                        </tr>
                        <tr class="data-point">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center">
                                        <span class="text-white font-semibold text-sm">CS</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-white">Custom Solutions</p>
                                        <p class="text-xs text-muted-foreground">Bespoke packages</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2.5 py-1 bg-red-500/20 text-red-400 border border-red-500/30 text-xs font-medium rounded-full">Custom</span>
                            </td>
                            <td class="px-6 py-4">
                                <p class="text-sm font-semibold text-white">$8,860</p>
                                <p class="text-xs text-muted-foreground">3.6% of total</p>
                            </td>
                            <td class="px-6 py-4 text-sm text-foreground">142</td>
                            <td class="px-6 py-4 text-sm text-foreground">42.8%</td>
                            <td class="px-6 py-4">
                                <span class="flex items-center text-red-400 text-sm font-medium">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                                    </svg>
                                    2.3%
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="p-4 border-t border-border flex items-center justify-between">
                <p class="text-sm text-muted-foreground">Showing 5 of 24 products</p>
                <div class="flex items-center gap-2">
                    <button class="px-3 py-1.5 bg-muted hover:bg-muted/80 border border-border rounded-lg text-sm transition-all">Previous</button>
                    <button class="px-3 py-1.5 bg-primary/20 text-primary border border-primary/30 rounded-lg text-sm">1</button>
                    <button class="px-3 py-1.5 bg-muted hover:bg-muted/80 border border-border rounded-lg text-sm transition-all">2</button>
                    <button class="px-3 py-1.5 bg-muted hover:bg-muted/80 border border-border rounded-lg text-sm transition-all">3</button>
                    <button class="px-3 py-1.5 bg-muted hover:bg-muted/80 border border-border rounded-lg text-sm transition-all">Next</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 flex flex-col gap-2 z-50"></div>

    <script>
        // Initialize Charts
        Chart.defaults.color = 'hsl(240 5% 64.9%)';
        Chart.defaults.borderColor = 'hsl(240 3.7% 15.9%)';
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';

        // Revenue Chart
        const revenueCtx = document.getElementById('revenue-chart').getContext('2d');
        const revenueChart = new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Revenue',
                    data: [185000, 198000, 212000, 225000, 238000, 247800],
                    borderColor: 'hsl(142 76% 56%)',
                    backgroundColor: 'hsla(142 76% 56% / 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'hsl(142 76% 56%)',
                    pointBorderColor: 'hsl(240 10% 7%)',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'hsl(240 10% 7%)',
                        titleColor: 'hsl(0 0% 98%)',
                        bodyColor: 'hsl(240 5% 64.9%)',
                        borderColor: 'hsl(240 3.7% 15.9%)',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: (context) => `$${context.parsed.y.toLocaleString()}`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            callback: (value) => `$${(value / 1000).toFixed(0)}K`
                        },
                        grid: {
                            color: 'hsl(240 3.7% 15.9% / 0.5)'
                        }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        // Users Chart
        const usersCtx = document.getElementById('users-chart').getContext('2d');
        const usersChart = new Chart(usersCtx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'New Users',
                    data: [1240, 1580, 1820, 1650, 1920, 2180, 2340],
                    backgroundColor: 'hsl(217 91% 60% / 0.8)',
                    borderRadius: 6,
                    borderSkipped: false
                }, {
                    label: 'Returning Users',
                    data: [2340, 2680, 2920, 2750, 3120, 3380, 3540],
                    backgroundColor: 'hsl(262 83% 58% / 0.6)',
                    borderRadius: 6,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            boxHeight: 12,
                            padding: 12,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'hsl(240 10% 7%)',
                        titleColor: 'hsl(0 0% 98%)',
                        bodyColor: 'hsl(240 5% 64.9%)',
                        borderColor: 'hsl(240 3.7% 15.9%)',
                        borderWidth: 1,
                        padding: 12
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        stacked: false,
                        grid: {
                            color: 'hsl(240 3.7% 15.9% / 0.5)'
                        }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        // Toast notification system
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');

            const colors = {
                info: 'bg-blue-500/20 border-blue-500/30 text-blue-400',
                success: 'bg-emerald-500/20 border-emerald-500/30 text-emerald-400',
                warning: 'bg-amber-500/20 border-amber-500/30 text-amber-400',
                error: 'bg-red-500/20 border-red-500/30 text-red-400',
            };

            toast.className = `${colors[type]} px-4 py-3 rounded-lg border text-sm transition-all duration-300 transform translate-x-0 opacity-100`;
            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Handle date range change - triggers QueryTimeoutException
        let clickCount = 0;
        let lastClickTime = 0;

        function handleDateRangeChange(value) {
            if (value === '30days') {
                showToast('Fetching 30-day analytics...', 'info');

                // Simulate loading state
                const btn = document.getElementById('refresh-btn');
                const originalHTML = btn.innerHTML;
                btn.disabled = true;
                btn.innerHTML = '<div class="loading-spinner w-4 h-4 rounded-full"></div> Loading...';

                setTimeout(() => {
                    fetch('/api/analytics/query-timeout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ range: '30days' })
                    }).then(() => {
                        showToast('Query timeout - please try a smaller date range', 'error');
                        btn.disabled = false;
                        btn.innerHTML = originalHTML;
                        document.getElementById('date-range').value = '7days';
                    }).catch(() => {
                        showToast('Database query exceeded timeout limit', 'error');
                        btn.disabled = false;
                        btn.innerHTML = originalHTML;
                        document.getElementById('date-range').value = '7days';
                    });
                }, 500);
            }
        }

        // Export CSV - triggers MemoryLimitException
        function exportCSV() {
            showToast('Preparing CSV export...', 'info');

            const btn = document.getElementById('export-csv-btn');
            const originalHTML = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner w-4 h-4 rounded-full"></div> Exporting...';

            fetch('/api/analytics/export-csv', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            }).then(() => {
                showToast('Memory limit exceeded during export', 'error');
                btn.disabled = false;
                btn.innerHTML = originalHTML;
            }).catch(() => {
                showToast('Failed to export: memory limit exceeded', 'error');
                btn.disabled = false;
                btn.innerHTML = originalHTML;
            });
        }

        // Refresh dashboard - triggers RateLimitException on rapid clicks
        function refreshDashboard() {
            const currentTime = Date.now();

            // Check if clicked within 2 seconds
            if (currentTime - lastClickTime < 2000) {
                clickCount++;

                if (clickCount >= 3) {
                    showToast('Triggering refresh...', 'warning');

                    const btn = document.getElementById('refresh-btn');
                    const originalHTML = btn.innerHTML;
                    btn.disabled = true;
                    btn.innerHTML = '<div class="loading-spinner w-4 h-4 rounded-full"></div> Refreshing...';

                    fetch('/api/analytics/rate-limit', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    }).then(() => {
                        showToast('Rate limit exceeded - please wait before refreshing', 'error');
                        btn.disabled = false;
                        btn.innerHTML = originalHTML;
                        clickCount = 0;
                    }).catch(() => {
                        showToast('Too many requests - please slow down', 'error');
                        btn.disabled = false;
                        btn.innerHTML = originalHTML;
                        clickCount = 0;
                    });

                    return;
                }
            } else {
                clickCount = 1;
            }

            lastClickTime = currentTime;

            // Normal refresh
            showToast('Dashboard refreshed', 'success');
            document.getElementById('last-updated').textContent = 'Updated just now';
        }

        // Update timestamp periodically
        setInterval(() => {
            const lastUpdated = document.getElementById('last-updated');
            const currentText = lastUpdated.textContent;

            if (currentText === 'Updated just now') {
                lastUpdated.textContent = 'Updated 1m ago';
            } else if (currentText.includes('m ago')) {
                const minutes = parseInt(currentText) + 1;
                if (minutes > 5) {
                    lastUpdated.textContent = 'Updated 5m+ ago';
                } else {
                    lastUpdated.textContent = `Updated ${minutes}m ago`;
                }
            }
        }, 60000);
    </script>

    <!-- Debug Panel (Error Testing) -->
    <div id="debug-panel" class="fixed bottom-4 left-4 z-50">
        <button onclick="toggleDebugPanel()" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
            <span id="debug-toggle-text">Test Errors</span>
        </button>
        <div id="debug-content" class="hidden mt-2 bg-card rounded-xl shadow-2xl border border-border p-4 w-72">
            <h4 class="font-semibold text-foreground mb-3 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-purple-500 animate-pulse"></span>
                Trigger Test Errors
            </h4>
            <div class="space-y-2">
                <button onclick="triggerAnalyticsError('/api/analytics/query-timeout')" class="w-full text-left px-3 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 text-sm font-medium transition-colors">
                    ‚è±Ô∏è Query Timeout
                </button>
                <button onclick="triggerAnalyticsError('/api/analytics/export-csv')" class="w-full text-left px-3 py-2 rounded-lg bg-orange-500/20 hover:bg-orange-500/30 text-orange-400 text-sm font-medium transition-colors">
                    üíæ Memory Limit (CSV Export)
                </button>
                <button onclick="triggerAnalyticsError('/api/analytics/rate-limit')" class="w-full text-left px-3 py-2 rounded-lg bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 text-sm font-medium transition-colors">
                    üö¶ Rate Limit Exceeded
                </button>
                <button onclick="triggerAnalyticsError('/test/http/500')" class="w-full text-left px-3 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 text-sm font-medium transition-colors">
                    üî• Server Error 500
                </button>
            </div>
            <div class="mt-3 pt-3 border-t border-border text-xs text-muted-foreground">
                Session: <code class="bg-muted px-1 rounded" id="session-id-display">loading...</code>
            </div>
        </div>
    </div>

    <script>
        function toggleDebugPanel() {
            const content = document.getElementById('debug-content');
            const text = document.getElementById('debug-toggle-text');
            content.classList.toggle('hidden');
            text.textContent = content.classList.contains('hidden') ? 'Test Errors' : 'Hide';
        }

        async function triggerAnalyticsError(path) {
            showToast('Triggering error...', 'info');
            try {
                await fetch(path, { method: 'POST', headers: { 'Content-Type': 'application/json' } });
                showToast('Error triggered! Check ErrorWatch dashboard.', 'success');
            } catch (e) {
                showToast('Error sent with replay!', 'success');
            }
        }

        // Display session ID
        setTimeout(() => {
            const sessionId = window.ErrorMonitoringReplay?.getSessionId?.() || 'N/A';
            const display = document.getElementById('session-id-display');
            if (display) display.textContent = sessionId.substring(0, 8) + '...';
        }, 1000);
    </script>

    <!-- Session Replay Script (rrweb) -->
    {{ error_monitoring_replay_script()|raw }}
</body>
</html>
