<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Replay Demo - ErrorWatch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(0 0% 3.9%)',
                        foreground: 'hsl(0 0% 98%)',
                        card: 'hsl(0 0% 7%)',
                        border: 'hsl(0 0% 14.9%)',
                        primary: 'hsl(262 83% 58%)',
                        muted: 'hsl(0 0% 14.9%)',
                        'muted-foreground': 'hsl(0 0% 63.9%)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: hsl(0 0% 3.9%);
            background-image:
                radial-gradient(ellipse 80% 50% at 50% -20%, hsl(262 83% 58% / 0.15), transparent);
        }
    </style>
</head>
<body class="dark min-h-screen text-foreground">
    <div class="max-w-4xl mx-auto p-8">
        <!-- Header -->
        <div class="mb-8">
            <a href="/" class="inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m15 18-6-6 6-6"/>
                </svg>
                Back to Dashboard
            </a>
            <h1 class="text-3xl font-bold text-foreground">Session Replay Demo</h1>
            <p class="text-muted-foreground mt-2">
                Interact with this page to test session replay capture. All mouse movements, clicks, scrolls, and inputs are being recorded.
            </p>
            <div class="mt-4 inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 text-sm">
                <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                Recording Active
            </div>
        </div>

        <!-- Test Sections -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Input Tests -->
            <div class="bg-card border border-border rounded-xl p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                        <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"/>
                    </svg>
                    Input Tests
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-muted-foreground mb-1">Text Input</label>
                        <input type="text" placeholder="Type something here..."
                               class="w-full px-3 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none text-foreground placeholder:text-muted-foreground">
                    </div>
                    <div>
                        <label class="block text-sm text-muted-foreground mb-1">Email (will be masked)</label>
                        <input type="email" placeholder="your@email.com"
                               class="w-full px-3 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none text-foreground placeholder:text-muted-foreground">
                    </div>
                    <div>
                        <label class="block text-sm text-muted-foreground mb-1">Password (will be masked)</label>
                        <input type="password" placeholder="Secret password"
                               class="w-full px-3 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none text-foreground">
                    </div>
                    <div>
                        <label class="block text-sm text-muted-foreground mb-1">Text Area</label>
                        <textarea placeholder="Write a longer message..." rows="3"
                                  class="w-full px-3 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none text-foreground placeholder:text-muted-foreground resize-none"></textarea>
                    </div>
                </div>
            </div>

            <!-- Click Tests -->
            <div class="bg-card border border-border rounded-xl p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                        <path d="M9 3 5 7l4 4"/>
                        <path d="m15 21 4-4-4-4"/>
                        <path d="M5 7h14"/>
                        <path d="M19 17H5"/>
                    </svg>
                    Click Tests
                </h2>
                <div class="space-y-4">
                    <button id="btn-primary" class="w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors font-medium">
                        Primary Button
                    </button>
                    <button id="btn-success" class="w-full px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-medium">
                        Success Button
                    </button>
                    <button id="btn-warning" class="w-full px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors font-medium">
                        Warning Button
                    </button>
                    <div class="flex gap-2">
                        <button class="flex-1 px-4 py-2 bg-muted text-foreground rounded-lg hover:bg-muted/80 transition-colors">
                            Left
                        </button>
                        <button class="flex-1 px-4 py-2 bg-muted text-foreground rounded-lg hover:bg-muted/80 transition-colors">
                            Center
                        </button>
                        <button class="flex-1 px-4 py-2 bg-muted text-foreground rounded-lg hover:bg-muted/80 transition-colors">
                            Right
                        </button>
                    </div>
                    <a href="#scroll-target" class="block text-center px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors">
                        Scroll to Target Below
                    </a>
                </div>
            </div>
        </div>

        <!-- Interactive Elements -->
        <div class="bg-card border border-border rounded-xl p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                    <rect width="7" height="7" x="3" y="3" rx="1"/>
                    <rect width="7" height="7" x="14" y="3" rx="1"/>
                    <rect width="7" height="7" x="14" y="14" rx="1"/>
                    <rect width="7" height="7" x="3" y="14" rx="1"/>
                </svg>
                Interactive Elements
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="aspect-square bg-gradient-to-br from-rose-500/20 to-rose-500/5 border border-rose-500/30 rounded-xl flex items-center justify-center cursor-pointer hover:scale-105 transition-transform">
                    <span class="text-rose-400 font-medium">Click me</span>
                </div>
                <div class="aspect-square bg-gradient-to-br from-amber-500/20 to-amber-500/5 border border-amber-500/30 rounded-xl flex items-center justify-center cursor-pointer hover:scale-105 transition-transform">
                    <span class="text-amber-400 font-medium">Hover here</span>
                </div>
                <div class="aspect-square bg-gradient-to-br from-emerald-500/20 to-emerald-500/5 border border-emerald-500/30 rounded-xl flex items-center justify-center cursor-pointer hover:scale-105 transition-transform">
                    <span class="text-emerald-400 font-medium">Test box</span>
                </div>
                <div class="aspect-square bg-gradient-to-br from-sky-500/20 to-sky-500/5 border border-sky-500/30 rounded-xl flex items-center justify-center cursor-pointer hover:scale-105 transition-transform">
                    <span class="text-sky-400 font-medium">Another one</span>
                </div>
            </div>
        </div>

        <!-- Error Triggers -->
        <div class="bg-rose-500/10 border border-rose-500/30 rounded-xl p-6 mb-8">
            <h2 class="text-xl font-semibold text-rose-400 mb-4 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                    <path d="M12 9v4"/>
                    <path d="M12 17h.01"/>
                </svg>
                Trigger Errors (with Replay Context)
            </h2>
            <p class="text-muted-foreground mb-4">
                Click these buttons to trigger errors. The session replay will be linked to the error in the dashboard.
            </p>
            <div class="flex flex-wrap gap-4">
                <button id="trigger-error-btn"
                   class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium inline-flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="m15 9-6 6"/>
                        <path d="m9 9 6 6"/>
                    </svg>
                    Trigger Server Error (500)
                </button>
                <button id="trigger-js-error-btn"
                   class="px-6 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors font-medium inline-flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                    Trigger JS Error
                </button>
                <button id="trigger-crash-btn"
                   class="px-6 py-3 bg-rose-700 text-white rounded-lg hover:bg-rose-800 transition-colors font-medium inline-flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                    Trigger Fatal Crash (503)
                </button>
            </div>
        </div>

        <!-- Scroll Target -->
        <div id="scroll-target" class="min-h-[50vh] flex items-center justify-center">
            <div class="bg-card border border-border rounded-xl p-8 text-center">
                <div class="w-16 h-16 bg-primary/10 border border-primary/30 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                        <path d="M12 5v14"/>
                        <path d="m19 12-7 7-7-7"/>
                    </svg>
                </div>
                <h3 class="text-lg font-semibold mb-2">Scroll Target Reached!</h3>
                <p class="text-muted-foreground">
                    The scroll was captured in the session replay.
                    <br>All your interactions on this page are being recorded.
                </p>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-muted-foreground text-sm py-8">
            Session ID: <code class="text-primary">{{ error_monitoring_session_id() ?? 'Not active' }}</code>
        </div>
    </div>

    <!-- Replay Script -->
    {{ error_monitoring_replay_script()|raw }}

    <!-- Error Trigger Scripts -->
    <script>
    (function() {
        'use strict';

        // Helper to show status feedback
        function showStatus(message, type) {
            var statusDiv = document.createElement('div');
            statusDiv.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg text-white font-medium z-50 ' +
                (type === 'error' ? 'bg-red-600' : type === 'success' ? 'bg-emerald-600' : 'bg-amber-600');
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);
            setTimeout(function() { statusDiv.remove(); }, 3000);
        }

        // Trigger Server Error (500) via fetch - this will be detected by the intercepted fetch
        document.getElementById('trigger-error-btn').addEventListener('click', function() {
            showStatus('Triggering server error...', 'warning');
            fetch('{{ path('test_replay_error') }}')
                .then(function(response) {
                    if (!response.ok) {
                        showStatus('Server error triggered! Replay sent.', 'success');
                    }
                })
                .catch(function(err) {
                    showStatus('Error: ' + err.message, 'error');
                });
        });

        // Trigger JS Error directly - this will be detected by window.onerror
        document.getElementById('trigger-js-error-btn').addEventListener('click', function() {
            showStatus('Triggering JS error...', 'warning');
            setTimeout(function() {
                // This will trigger window.onerror which flushes the replay
                throw new Error('Intentional JavaScript error for replay testing');
            }, 100);
        });

        // Trigger Fatal Crash (503) via fetch
        document.getElementById('trigger-crash-btn').addEventListener('click', function() {
            showStatus('Triggering fatal crash...', 'warning');
            fetch('{{ path('test_replay_crash') }}')
                .then(function(response) {
                    if (!response.ok) {
                        showStatus('Fatal crash triggered! Replay sent.', 'success');
                    }
                })
                .catch(function(err) {
                    showStatus('Error: ' + err.message, 'error');
                });
        });

        // Log replay status
        if (window.ErrorMonitoringReplay) {
            console.log('[ReplayDemo] Replay active, sessionId:', window.ErrorMonitoringReplay.getSessionId());
            setInterval(function() {
                console.log('[ReplayDemo] Event count:', window.ErrorMonitoringReplay.getEventCount());
            }, 5000);
        } else {
            console.warn('[ReplayDemo] Replay not initialized');
        }
    })();
    </script>
</body>
</html>
